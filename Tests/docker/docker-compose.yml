version: '3'

services:

    ez:
        build:
            context: images/ez
            args:
                debian_mirror: ${COMPOSE_DEBIAN_MIRROR:-none}
                debian_version: ${COMPOSE_DEBIAN_VERSION:-buster}
                php_version: ${COMPOSE_PHP_VERSION:-default}
                timezone: ${COMPOSE_TZ:-none}
                do_update_os: ${COMPOSE_DO_UPDATE_OS:-true}
        hostname: ez
        container_name: ${COMPOSE_PROJECT_NAME:-kezmbtest}_ez
        environment:
            - CONTAINER_USER_UID=${CONTAINER_USER_UID:-1000}
            - CONTAINER_USER_GID=${CONTAINER_USER_GID:-1000}
            - DB_TYPE=${DB_TYPE:-mysql}
            - DB_HOST
            - MYSQL_VERSION=${MYSQL_VERSION:-5.6}
            - POSTGRESQL_VERSION=${POSTGRESQL_VERSION:-9.5}
            - DB_ROOT_PASSWORD=${DB_ROOT_PASSWORD:-root_test}
            - DB_CHARSET
            - DB_EZ_USER=${DB_EZ_USER:-ezp}
            - DB_EZ_PASSWORD=${DB_EZ_PASSWORD:-ezp}
            - DB_EZ_DATABASE=${DB_EZ_DATABASE:-behattestdb}
            - COMPOSE_SETUP_APP_ON_BOOT
            # Configuration for the eZ test env to build
            - EZ_VERSION
            - EZ_PACKAGES=${EZ_PACKAGES:-ezsystems/ezplatform:^2.5.0 ezsystems/ezplatform-xmltext-fieldtype:^1.8 ezsystems/behatbundle:^6.5 netgen/tagsbundle:^3.0 sensio/generator-bundle overblog/graphiql-bundle}
            - EZ_COMPOSER_LOCK
            - EZ_BUNDLES=${EZ_BUNDLES:-Kaliop\eZMigrationBundle\EzMigrationBundle Lolautruche\EzCoreExtraBundle\EzCoreExtraBundle EzSystems\EzPlatformXmlTextFieldTypeBundle\EzSystemsEzPlatformXmlTextFieldTypeBundle Netgen\TagsBundle\NetgenTagsBundle}
            # Name of a symfony config file containing parameters and services used by the tests
            - EZ_TEST_CONFIG_SYMFONY
            - COMPOSER_VENDOR_DIR
            # Configuration used by Symfony when running via phpunit
            - APP_ENV=${APP_ENV:-behat}
            - SYMFONY_ENV=${SYMFONY_ENV:-behat}
            # As opposed to TRAVIS=true ;-)
            - DOCKER=true
        volumes:
            - ${COMPOSE_APP_DIR:-../../}:/home/test/bundle
            - ${COMPOSE_DATA_DIR:-./data}/.composer/:/home/test/.composer

#networks:
#    default:
#        ipam:
#            config:
#                - subnet: "${COMPOSE_SUBNET:-172.19.30}.0/24"
