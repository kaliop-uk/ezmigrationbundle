version: '3'

services:

    mysql:
        build:
            context: images/mysql
            args:
                timezone: ${COMPOSE_TZ:-none}
                do_update_os: ${COMPOSE_DO_UPDATE_OS:-true}
                # note: Travis Xenial and Bionic images come with mysql 5.7 by default; Focal comes with mysql 8.0
                #       But mysql 5.6 is not recommended for EZP 5.4, so we default to 5.6
                mysql_version: ${MYSQL_VERSION:-5.6}
        hostname: mysql
        container_name: ${COMPOSE_PROJECT_NAME:-kezmbtest}_mysql
        environment:
            - CONTAINER_USER_UID=${CONTAINER_USER_UID:-1000}
            - CONTAINER_USER_GID=${CONTAINER_USER_GID:-1000}
            - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD:-root_test}
            - MYSQL_USER=${DB_EZ_USER:-ezp}
            - MYSQL_PASSWORD=${DB_EZ_PASSWORD:-ezp}
            - MYSQL_DATABASE=${DB_EZ_DATABASE:-behattestdb}
            # As opposed to TRAVIS=true ;-)
            - DOCKER=true
        volumes:
            #- ./config/mysql/mysql_${COMPOSE_DB_SIZE}.cnf:/etc/mysql/conf.d/mysql.cnf
            - ${COMPOSE_DATA_DIR:-./data}/mysql/:/var/lib/mysql
            - ${COMPOSE_LOGS_DIR:-./logs}/mysql/:/var/log/mysql
        #tmpfs:
        #    # used for mysql temp tables. Useful with ez5 db schema / queries (it creates lots of temp tables on disk)
        #    - /tmpfs:mode=777
        # uncomment this to be able to access the db from the host
        #ports:
        #    - "3307:3306"
        # nb: this prevents the image to start on some ubuntu installs because of apparmor config...
        #privileged: true
